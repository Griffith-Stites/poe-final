<!doctype html>
<html lang="en">
<head>
  <title>Attractnid</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:100,300,400,700|Roboto:300,400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="fonts/icomoon/style.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/nouislider.min.css">
  <link rel="stylesheet" href="css/bootstrap-datetimepicker.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="px-4 navbar navbar-expand-lg navbar-dark bg-secondary">
    <a class= "navbar-brand" href="index.html">Home</a>
    <div class="dropdown">
      <button class="dropbtn">System
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <a href="mechanical.html">Mechanical</a>
        <a href="electrical.html">Electrical</a>
        <a href="software.html">Software/Firmware</a>
      </div>
    </div>
    <div class="dropdown">
      <button class="dropbtn">Sprints
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <a href="sprint1.html">Sprint 1</a>
        <a href="sprint2.html">Sprint 2</a>
        <a href="sprint3.html">Sprint 3</a>
        <a href="sprint4.html">Sprint 4</a>
      </div>
    </div>
  </div>
  <div class="site-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10 mx-auto text-center align-self-center">
          <h1 class="title mb-0">Software and Firmware</h1>
          <!-- <p><a href="#start" class="btn btn-primary px-4 py-3">More</a></p> -->
        </div>
      </div>
    </div>
  </div>
  <div class="site-section">
    <div class="container">
      <div class="section-heading mb-5">
        <h2>Overview</h2>
      </div>
      <img src="images/system/software/softwareDiagram.png" alt="Software diagram" class="img-fluid rounded">
      <p>The software and firmware involved in the robot’s operation is an intermediary between the user, who desires to stop, start, and turn the robot, and the legs’ and magnets’ motion. A python script running on a laptop sends commands to a serial port, which is transmitted via bluetooth to the Arduino, which generates leg motion.</p>
      <p>You can our full code on our <a href="https://github.com/Griffith-Stites/poe-final/">github</a>.</p>
    </div>
  </div>
  <div class="site-section bg-light">
    <div class="container">
      <div class="section-heading mb-5">
        <h2>Arduino Firmware</h2>
      </div>
      <p>We wanted the robot to travel as quickly as possible, so we experimented with different patterns of leg movement to balance speed with the limitations of the servos. After some testing, we determined that pairing leg strides together on the diagonal and minimizing pauses between magnet swap commands to 0.7 seconds allowed for the fastest travel.</p>
      <p>The robot’s motion is based around a control loop which corrects the robot’s walking towards whatever heading the user specifies.</p>
      <code class="language-pascal">
        <p>void setWalkingAngles() {</p>
          <p>&emsp;&emsp;float robotAngle = getRobotAngle();</p>
          <p>&emsp;&emsp;float d = robotAngle - desiredHeading;</p>
          <br>
          <p>&emsp;&emsp;brAngle = -(max_angle + d*dt);</p>
          <p>&emsp;&emsp;frAngle = max_angle + d*dt;</p>
          <p>&emsp;&emsp;blAngle = -(max_angle-d*dt);</p>
          <p>&emsp;&emsp;flAngle = max_angle - d*dt;</p>
        <p>}</p>
      </code>
      <p>Between each stride, a loop checks for user input, updates the desired robot angle if they’ve pressed ‘a’ or ‘d’ (left or right), updates the ‘start/stop’ flag, checks for readings from the accelerometer to calculate actual heading, and uses the difference between current and desired to change the bounds of the leg rotation servos.</p>
    </div>
  </body>
</div>
<div class="site-section">
  <div class="container">
    <div class="section-heading mb-5">
      <h2>Next Steps</h2>
    </div>
    <div class="container">
      <div class = "row">
        <div class = "col-lg 10">
          <h4>Controller Code</h4>
          <p>Our robot takes commands from the computer via Arduino’s serial monitor. This means a command must be entered and then sent in two separate steps. We hoped to have a smoother control system where arrow keys could be used to quickly change the robots behavior. To achieve this we began writing a program using Python’s pygame library that could take commands from keys and send them directly to the robot via Bluetooth.</p>
          <p>However, the connection between Python and Arduino proved difficult to create, especially with the Bluetooth’s use of a second serial connection. Additionally, one of our Bluetooth modules short circuited and became useless, making this program worthless until we can secure a new module.</p>
        </div>
      </div>
    </div>
    <div class="container">
      <div class = "row">
        <div class = "col-lg 10">
          <h4>Motion in Any Direction without Rotation</h4>
          <p>One goal we attempted to achieve was a program to move the robot in any direction without changing its orientation.</p>
          <p>Our program modeled the robot visually using Python’s pygame library. It projected the robot one step ahead of its current position in the desired direction. By slowly increasing the size of the projected step we could maximize the distance the robot could move in each stride before surpassing the leg’s physical limitations. The visual model used collision detection to compare the robot’s current range of leg motion to the projected step’s field of possible leg positions.</p>
          <img src="images/system/software/motionWoRotation.png" alt="Pygame image of the model" class="img-fluid w-80 rounded center">
          <br>
          <p>In this visualization, the red square is the robot’s body, the purple lines are its legs, the blue arcs represent the current potential leg positions, and the orange arcs represent the projected potential positions, taking into account the ability of the legs to compress each step. When two corresponding colored arcs no longer overlap, that leg cannot be placed anywhere and still propel the robot the entirety of the step distance. The robot only needs two legs attached to move; this model enabled us to find which two legs needed to be placed where to optimize the step distance.</p>
          <p>Unfortunately, we were unable to complete this program due to time constraints and other priorities. Hopefully, a future model could implement this algorithm so a user could send the robot scuttling in any direction.</p>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
